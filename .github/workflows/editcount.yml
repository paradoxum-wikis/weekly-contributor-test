name: What Could This Be?

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

permissions:
  contents: write

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch and check
        run: |
          if [ -f .milestone_sent ]; then
            echo "Milestone already reached."
            exit 0
          fi
          response=$(curl -s "https://tds.fandom.com/api.php?action=query&format=json&list=users&ususers=Mentin123&usprop=editcount")
          editcount=$(echo "$response" | jq -r '.query.users[0].editcount')
          if [ "$editcount" -ge 100000 ]; then
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@380694434980954114> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üéâ Would you look at that!",
                    "color": 16777077,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyou.png?v=2"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@1175202834749337741> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üò± Sir, a second message has hit the server!",
                    "color": 4280800,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyourusty.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@250529133308674048> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üòà Now that's a bold one...",
                    "color": 15357490,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyouwikia.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@665163645206134825> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "‚úåÔ∏è Unc?!?",
                    "color": 0,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyoumono.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@1372605825193087066> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üî¥ His favorite is red, too!",
                    "color": 11207189,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyoured.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@653813863971684373> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üòè Well, that's flattering.",
                    "color": 6895309,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyoucyber.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@1319627806615015494> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üéÉ The guy has only been here recently, yet you've made such an impact on him!",
                    "color": 16738816,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyouloe.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@699019082384539700> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üëÅÔ∏è I'm seeing something...",
                    "color": 421937,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyouvisible.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@937386825562062858> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "‚ùÑÔ∏è Don't ask why that's on the top right.",
                    "color": 7451901,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyouzerox.png?v=2"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From <@639243615549390916> to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "‚òÑÔ∏è Interesting...",
                    "color": 1321810,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyoucastle.png"
                    }
                  }
                ]
              }'
            sleep 30
            curl -X POST "${{ secrets.WEBHOOK_URL }}" \
              -H "Content-Type: application/json" \
              -d '{
                "content": "From everyone to <@466609959023673345>",
                "embeds": [
                  {
                    "title": "üëã This is the final one! (And sorry for hijacking the channel, dehehe.)",
                    "color": 49151,
                    "image": {
                      "url": "https://bin.t7ru.link/thankyouall.png"
                    }
                  }
                ]
              }'
            touch .milestone_sent
            git config --local user.email "action@github.com"
            git config --local user.name "GitHub Action"
            git add .milestone_sent
            git commit -m "chore: milestone reached" || echo "No changes to commit"
            git push
          fi
